<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦· Plan Higieny Jamy Ustnej</title>
    <style>
        :root {
            --teal: #0d9488;
            --teal-light: #ccfbf1;
            --teal-dark: #115e59;
            --pink: #ec4899;
            --bg: #f0fdfa;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        .container { max-width: 720px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--teal), var(--teal-dark));
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(13, 148, 136, 0.3);
        }
        .header h1 { font-size: 1.8rem; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 0.95rem; }
        .header .tooth { font-size: 3rem; margin-bottom: 10px; }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: white;
            padding: 6px;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--muted);
            transition: all 0.2s;
        }
        .tab.active {
            background: var(--teal);
            color: white;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }
        .tab:hover:not(.active) { background: var(--teal-light); color: var(--teal-dark); }
        
        /* Question Card */
        .question-card {
            background: var(--card);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .question-card h3 {
            color: var(--teal-dark);
            margin-bottom: 6px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .question-card p {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 18px;
        }
        
        .option {
            display: block;
            width: 100%;
            padding: 14px 18px;
            margin-bottom: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            text-align: left;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .option:hover { border-color: var(--teal); background: var(--teal-light); }
        .option.selected { border-color: var(--teal); background: var(--teal-light); color: var(--teal-dark); font-weight: 600; }
        
        /* Progress */
        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin-bottom: 24px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--teal), var(--pink));
            border-radius: 3px;
            transition: width 0.4s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 8px;
        }
        
        /* Plan Output */
        .plan-output {
            background: var(--card);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            line-height: 1.7;
        }
        .plan-output h2 {
            color: var(--teal-dark);
            border-bottom: 2px solid var(--teal-light);
            padding-bottom: 8px;
            margin: 24px 0 16px 0;
        }
        .plan-output h2:first-child { margin-top: 0; }
        .plan-output ul { padding-left: 20px; margin: 8px 0; }
        .plan-output .step {
            background: var(--teal-light);
            border-left: 4px solid var(--teal);
            padding: 14px 18px;
            border-radius: 0 10px 10px 0;
            margin: 10px 0;
        }
        .plan-output .step-num {
            font-weight: 700;
            color: var(--teal);
            display: block;
            margin-bottom: 4px;
        }
        .plan-output .shopping-item {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px 16px;
            border-radius: 0 10px 10px 0;
            margin: 8px 0;
        }
        .plan-output .zasada {
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .plan-output .zasada:last-child { border-bottom: none; }
        
        /* Buttons */
        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: var(--teal);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { background: var(--teal-dark); transform: translateY(-1px); }
        .btn-outline {
            background: transparent;
            border: 2px solid var(--teal);
            color: var(--teal);
        }
        .btn-outline:hover { background: var(--teal-light); }
        .btn-row { display: flex; gap: 12px; justify-content: center; margin-top: 24px; }
        
        /* Chat */
        .chat-container {
            background: var(--card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        .chat-header {
            background: linear-gradient(135deg, var(--teal), var(--teal-dark));
            color: white;
            padding: 16px 20px;
            font-weight: 600;
        }
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
        }
        .chat-msg {
            margin-bottom: 12px;
            max-width: 85%;
            animation: fadeIn 0.2s ease;
        }
        .chat-msg.bot { margin-right: auto; }
        .chat-msg.user { margin-left: auto; }
        .chat-msg .bubble {
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .chat-msg.bot .bubble { background: #f1f5f9; color: var(--text); border-bottom-left-radius: 4px; }
        .chat-msg.user .bubble { background: var(--teal); color: white; border-bottom-right-radius: 4px; }
        .chat-input-row {
            display: flex;
            gap: 8px;
            padding: 16px;
            border-top: 1px solid #e2e8f0;
        }
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            outline: none;
        }
        .chat-input:focus { border-color: var(--teal); }
        .chat-send {
            padding: 12px 20px;
            background: var(--teal);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        .chat-send:hover { background: var(--teal-dark); }
        .chat-config {
            padding: 16px 20px;
            background: #fef3c7;
            border-bottom: 1px solid #fde68a;
            font-size: 0.85rem;
        }
        .chat-config input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-top: 6px;
            font-size: 0.85rem;
        }
        
        .hidden { display: none; }
        
        /* Print */
        @media print {
            .tabs, .header, .btn-row, .no-print { display: none; }
            .plan-output { box-shadow: none; padding: 0; }
        }
        
        /* Mobile */
        @media (max-width: 600px) {
            .container { padding: 12px; }
            .header { padding: 28px 16px; border-radius: 14px; }
            .header h1 { font-size: 1.4rem; }
            .question-card { padding: 20px; }
            .plan-output { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="tooth">ğŸ¦·</div>
            <h1>Plan Higieny Jamy Ustnej</h1>
            <p>Spersonalizowany plan dla Twojego pacjenta</p>
        </div>
        
        <div class="tabs no-print">
            <button class="tab active" onclick="switchTab('planner')">ğŸ“‹ Kreator Planu</button>
            <button class="tab" onclick="switchTab('chat')">ğŸ’¬ Live Chat AI</button>
        </div>
        
        <!-- PLANNER TAB -->
        <div id="tab-planner">
            <div id="questions-section">
                <div class="progress-text" id="progress-text">Pytanie 1 z 7</div>
                <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width: 14.28%"></div></div>
                <div id="question-container"></div>
            </div>
            <div id="plan-section" class="hidden">
                <div class="plan-output" id="plan-output"></div>
                <div class="btn-row no-print">
                    <button class="btn btn-outline" onclick="resetPlanner()">ğŸ”„ Nowy plan</button>
                    <button class="btn btn-outline" onclick="copyPlanText()">ğŸ“‹ Kopiuj tekst</button>
                    <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Drukuj / PDF</button>
                </div>
                <div id="copy-toast" style="display:none; text-align:center; margin-top:12px; padding:10px; background:#ccfbf1; border-radius:10px; color:#115e59; font-weight:600;">âœ… Skopiowano do schowka!</div>
            </div>
        </div>
        
        <!-- CHAT TAB -->
        <div id="tab-chat" class="hidden">
            <div class="chat-container">
                <div class="chat-header">ğŸ¦· Asystent Higienistki â€” GPT-OSS 120B</div>
                <div class="chat-config">
                    âš™ï¸ Adres API (LiteLLM): 
                    <input type="text" id="api-url" value="http://192.168.1.80:4000/v1/chat/completions" placeholder="http://192.168.1.80:4000/v1/chat/completions">
                    <div style="margin-top:4px; color:#92400e;">DziaÅ‚a tylko w sieci lokalnej. <a href="#" onclick="testApi()">Testuj poÅ‚Ä…czenie</a></div>
                </div>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-row">
                    <input class="chat-input" id="chat-input" placeholder="Wpisz 'Start' aby rozpoczÄ…Ä‡..." onkeydown="if(event.key==='Enter')sendChat()">
                    <button class="chat-send" onclick="sendChat()">WyÅ›lij</button>
                </div>
            </div>
        </div>
    </div>

<script>
// ============ BLOCK LIBRARY ============
const blocks = {
    R1: `ROZPOZNANIE KLINICZNE\nâ€¢ DziÄ…sÅ‚a zdrowe, brak stanu zapalnego\nâ€¢ Dobra kontrola biofilmu bakteryjnego\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Utrzymanie zdrowia dziÄ…seÅ‚ i zÄ™bÃ³w\nâ€¢ Profilaktyka prÃ³chnicy\nâ€¢ Utrwalenie prawidÅ‚owych nawykÃ³w higienicznych`,
    R2: `ROZPOZNANIE KLINICZNE\nâ€¢ Stan zapalny dziÄ…seÅ‚\nâ€¢ ObecnoÅ›Ä‡ biofilmu i kamienia nazÄ™bnego\nâ€¢ Krwawienie podczas szczotkowania lub sondowania\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Redukcja stanu zapalnego dziÄ…seÅ‚\nâ€¢ Poprawa kontroli biofilmu bakteryjnego\nâ€¢ CaÅ‚kowite wyeliminowanie krwawienia\nâ€¢ Ochrona przed rozwojem choroby przyzÄ™bia`,
    R3: `ROZPOZNANIE KLINICZNE\nâ€¢ NadwraÅ¼liwoÅ›Ä‡ zÄ™bÃ³w na bodÅºce termiczne\nâ€¢ Starcia zÄ™bÃ³w â€” ubytki nieprÃ³chnicowe\nâ€¢ MoÅ¼liwy bruksizm lub zbyt mocne szczotkowanie\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Wzmocnienie i remineralizacja szkliwa\nâ€¢ Redukcja nadwraÅ¼liwoÅ›ci\nâ€¢ Delikatna technika szczotkowania\nâ€¢ Ochrona przed dalszymi starciami`,
    R4: `ROZPOZNANIE KLINICZNE\nâ€¢ Aktywna prÃ³chnica lub wysokie ryzyko prÃ³chnicy\nâ€¢ NiewystarczajÄ…ca kontrola biofilmu bakteryjnego\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Wzmocnienie szkliwa fluorami\nâ€¢ Poprawa kontroli biofilmu\nâ€¢ Redukcja ryzyka nowych ubytkÃ³w\nâ€¢ Wsparcie remineralizacji wczesnych zmian`,
    R5: `ROZPOZNANIE KLINICZNE\nâ€¢ Obfite zÅ‚ogi kamienia nazÄ™bnego\nâ€¢ PodwyÅ¼szone ryzyko stanu zapalnego dziÄ…seÅ‚\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Spowolnienie tworzenia siÄ™ nowego kamienia\nâ€¢ Utrzymanie efektu higienizacji na dÅ‚uÅ¼ej\nâ€¢ Ochrona dziÄ…seÅ‚ przed stanem zapalnym\nâ€¢ Poprawa techniki czyszczenia przestrzeni miÄ™dzyzÄ™bowych`,
    R6: `ROZPOZNANIE KLINICZNE\nâ€¢ Halitoza â€” nieprzyjemny zapach z jamy ustnej\nâ€¢ Nadmiar bakterii beztlenowych na jÄ™zyku i w przestrzeniach miÄ™dzyzÄ™bowych\n\nCEL PLANU HIGIENIZACYJNEGO\nâ€¢ Redukcja bakterii w jamie ustnej\nâ€¢ Regularne czyszczenie jÄ™zyka\nâ€¢ DokÅ‚adne czyszczenie przestrzeni miÄ™dzyzÄ™bowych\nâ€¢ Poprawa Å›wieÅ¼oÅ›ci oddechu i komfortu`,
    F1: `Szczoteczka elektryczna soniczna: Oral-B iO 3 lub iO 6\nKoÅ„cÃ³wki: Gentle Care (ochrona dziÄ…seÅ‚) + Interdental Clean (okolice przydziÄ…sÅ‚owe)\nGdzie kupiÄ‡: Rossmann, Hebe, Media Markt, apteki, online`,
    F2: `Szczoteczka elektryczna rotacyjna: Oral-B seria Pro lub Vitality\nGdzie kupiÄ‡: Rossmann, Hebe, Media Markt, apteki`,
    F3: `Szczoteczka manualna: Oral-B Pro-Expert, Colgate lub Elmex (miÄ™kkie wÅ‚osie)\nGdzie kupiÄ‡: Rossmann, Hebe, apteki`,
    F1p: `Szczoteczka elektryczna soniczna Oral-B iO 3 lub iO 6\nKoÅ„cÃ³wka: Gentle Care + Interdental Clean (przydziÄ…sÅ‚owo)\nCzas szczotkowania: minimum 2 minuty`,
    F2p: `Szczoteczka elektryczna rotacyjna Oral-B Pro lub Vitality\nTechnika: prowadÅº gÅ‚Ã³wkÄ™ zÄ…b po zÄ™bie, delikatny docisk\nCzas szczotkowania: minimum 2 minuty`,
    F3p: `Szczoteczka manualna (miÄ™kkie wÅ‚osie)\nTechnika: okrÄ™Å¼na, przy linii dziÄ…seÅ‚, delikatny docisk\nCzas szczotkowania: minimum 2 minuty`,
    G1: `Szczoteczki miÄ™dzyzÄ™bowe: Elgydium 0,8 mm / 1,2 mm\nGdzie kupiÄ‡: apteki, sklepy stomatologiczne, online`,
    G2: `NiÄ‡ dentystyczna: Oral-B Pro-Expert\nGdzie kupiÄ‡: Rossmann, Hebe, apteki, online`,
    G3: `Irygator: Oral-B Aquacare 4\nGdzie kupiÄ‡: Media Markt, Rossmann (wiÄ™ksze sklepy), apteki, online`,
    G4: `Szczoteczki miÄ™dzyzÄ™bowe: Elgydium 0,8 mm / 1,2 mm\nIrygator: Oral-B Aquacare 4\nGdzie kupiÄ‡: Rossmann, Hebe, Media Markt, apteki, online`,
    G1p: `Szczoteczki miÄ™dzyzÄ™bowe Elgydium 0,8 mm lub 1,2 mm\nStosowaÄ‡ codziennie wieczorem, przed szczotkowaniem zÄ™bÃ³w`,
    G2p: `NiÄ‡ dentystyczna Oral-B Pro-Expert\nStosowaÄ‡ codziennie wieczorem, przed szczotkowaniem zÄ™bÃ³w`,
    G3p: `Irygator Oral-B Aquacare 4\nStosowaÄ‡ 2â€“3 razy w tygodniu, po szczotkowaniu\nSzczegÃ³lnie: wzdÅ‚uÅ¼ linii dziÄ…seÅ‚ i w przestrzeniach miÄ™dzyzÄ™bowych`,
    G4a: `Szczoteczki miÄ™dzyzÄ™bowe Elgydium 0,8 mm lub 1,2 mm\nStosowaÄ‡ codziennie wieczorem, przed szczotkowaniu zÄ™bÃ³w`,
    H1: `Pasta z fluorkiem cyny: Oral-B Pro-Expert Advanced\nGdzie kupiÄ‡: Rossmann, Hebe, apteki`,
    H2: `Pasta poranna: Curasept Biosmalto (rÃ³Å¼owa) â€” hydroksyapatyt\nGdzie kupiÄ‡: Superpharm, apteki stomatologiczne, online\n\nPasta wieczorna: Oral-B Pro-Expert Advanced â€” fluorek cyny\nGdzie kupiÄ‡: Rossmann, Hebe, apteki`,
    H3: `Pasta z hydroksyapatytem: Curasept Biosmalto (rÃ³Å¼owa)\nGdzie kupiÄ‡: Superpharm, apteki stomatologiczne, online`,
    H1p: `Pasta z fluorkiem cyny: Oral-B Pro-Expert Advanced\nStosowanie: po szczotkowaniu wieczornym â€” nie pÅ‚ukaÄ‡ wodÄ… po naÅ‚oÅ¼eniu`,
    H2a: `Pasta z hydroksyapatytem: Curasept Biosmalto (rÃ³Å¼owa)\nStosowanie: rano po przebudzeniu, nie jeÅ›Ä‡ przez 30 min`,
    H2b: `Pasta z fluorkiem cyny: Oral-B Pro-Expert Advanced\nStosowanie: po szczotkowaniu wieczornym â€” nie pÅ‚ukaÄ‡ wodÄ… po naÅ‚oÅ¼eniu`,
    H3p: `Pasta z hydroksyapatytem: Curasept Biosmalto (rÃ³Å¼owa)\nStosowanie: wieczorem po szczotkowaniu â€” nie pÅ‚ukaÄ‡ wodÄ… po naÅ‚oÅ¼eniu`,
    I1: `PÅ‚yn do pÅ‚ukania: Alfa Scaling\nKiedy: raz dziennie wieczorem, przez 7 dni po higienizacji\nGdzie kupiÄ‡: apteki, sklepy stomatologiczne online`,
    I1p: `PÅ‚yn Alfa Scaling\nPÅ‚ukaÄ‡ 30â€“60 sekund po szczotkowaniu wieczornym\nNie pÅ‚ukaÄ‡ wodÄ… po uÅ¼yciu, nie jeÅ›Ä‡ przez 30 min\nStosowaÄ‡ przez 7 dni po higienizacji`,
    J1: `Skrobak do jÄ™zyka\nGdzie kupiÄ‡: Rossmann, Hebe`,
    J1p: `Oczyszczanie jÄ™zyka skrobakiem\nWykonaÄ‡ wieczorem, po szczotkowaniu zÄ™bÃ³w â€” przeciÄ…gnÄ…Ä‡ skrobak od nasady jÄ™zyka ku przodowi 3â€“5 razy`,
    X1: `TWOJA NASTÄ˜PNA WIZYTA: za 3 miesiÄ…ce\n\nKrÃ³tszy odstÄ™p pozwala na szybszÄ… kontrolÄ™ stanu zapalnego, monitorowanie postÄ™pÃ³w higieny domowej i wczesne wykrycie ewentualnych problemÃ³w.\n\nPamiÄ™taj: Zdrowy uÅ›miech to zdrowe dziÄ…sÅ‚a! ğŸ’ª`,
    X2: `TWOJA NASTÄ˜PNA WIZYTA: za 6 miesiÄ™cy\n\nStandardowy odstÄ™p zapewniajÄ…cy utrzymanie zdrowia dziÄ…seÅ‚, profesjonalne usuniÄ™cie kamienia i osadÃ³w oraz aktualizacjÄ™ planu higieny domowej.\n\nPamiÄ™taj: Zdrowy uÅ›miech to zdrowe dziÄ…sÅ‚a! ğŸ’ª`,
    X3: `TWOJA NASTÄ˜PNA WIZYTA: za 12 miesiÄ™cy\n\nRoczny odstÄ™p odpowiedni przy bardzo dobrym stanie higieny i braku aktywnych problemÃ³w. Nawet przy doskonaÅ‚ej higienie domowej coroczna wizyta jest niezbÄ™dna.\n\nPamiÄ™taj: Zdrowy uÅ›miech to zdrowe dziÄ…sÅ‚a! ğŸ’ª`,
    Z1: `Mycie zÄ™bÃ³w moÅ¼e wydawaÄ‡ siÄ™ proste. Jednak bez konkretnego, indywidualnego planu higienizacyjnego bardzo Å‚atwo popeÅ‚niaÄ‡ bÅ‚Ä™dy nawet wtedy, gdy wydaje siÄ™, Å¼e robisz "wszystko dobrze".\n\nDlatego po dzisiejszej wizycie przygotowaÅ‚am dla Ciebie spersonalizowany plan higieny jamy ustnej, dopasowany do Twoich aktualnych potrzeb.\n\nZNAJDZIESZ W NIM:\nâ€¢ Jasne zalecenia krok po kroku\nâ€¢ Konkretne produkty i narzÄ™dzia do higieny domowej\nâ€¢ WskazÃ³wki, ktÃ³re pomogÄ… Ci skutecznie zadbaÄ‡ o zdrowe dziÄ…sÅ‚a i zÄ™by\n\nCelem tego planu jest nie tylko poprawa Twojego stanu jamy ustnej, ale takÅ¼e budowanie Å›wiadomych nawykÃ³w, dziÄ™ki ktÃ³rym utrzymasz zdrowy uÅ›miech na dÅ‚ugie lata nawet do SETKI.`,
    Z2: `1. Myj zÄ™by minimum 2 minuty\nNie szybciej, nie "na oko". DokÅ‚adne szczotkowanie usuwa biofilm bakteryjny â€” gÅ‚Ã³wnÄ… przyczynÄ™ prÃ³chnicy i chorÃ³b dziÄ…seÅ‚.\n\n2. Szczotkuj delikatnie, ale dokÅ‚adnie\nBez szorowania, bez nadmiernego docisku. Technika i systematycznoÅ›Ä‡ sÄ… waÅ¼niejsze niÅ¼ siÅ‚a.\n\n3. UÅ¼ywaj pasty z fluorem\nWzmacnia szkliwo, wspiera remineralizacjÄ™, kontroluje bakterie. Unikaj past mocno Å›ciernych i zawierajÄ…cych SLS.\n\n4. Codziennie czyÅ›Ä‡ przestrzenie miÄ™dzyzÄ™bowe\nTo tam najczÄ™Å›ciej rozwija siÄ™ prÃ³chnica i zapalenie dziÄ…seÅ‚. Szczoteczki miÄ™dzyzÄ™bowe lub niÄ‡ â€” kaÅ¼dego dnia, najlepiej wieczorem.\n\n5. CzyÅ›Ä‡ jÄ™zyk\nNa jÄ™zyku gromadzi siÄ™ ogromna iloÅ›Ä‡ bakterii. Regularne czyszczenie poprawia Å›wieÅ¼oÅ›Ä‡ oddechu i wspiera zdrowie dziÄ…seÅ‚.\n\n6. Reaguj na krwawienie dziÄ…seÅ‚\nKrwawienie to nie norma â€” to sygnaÅ‚ ostrzegawczy. Wczesne wdroÅ¼enie prawidÅ‚owej higieny pozwala cofnÄ…Ä‡ stan zapalny.\n\n7. Myj zÄ™by w odpowiednim czasie\nPo posiÅ‚kach szczegÃ³lnie kwaÅ›nych odczekaj okoÅ‚o 30 minut. Chronisz szkliwo przed uszkodzeniem.\n\n8. Traktuj pÅ‚yn do pÅ‚ukania jako uzupeÅ‚nienie â€” unikaj tych z alkoholem\nPÅ‚yn nie zastÄ™puje szczotkowania ani czyszczenia przestrzeni miÄ™dzyzÄ™bowych.\n\n9. Zmieniaj nawyki, nie tylko produkty\nNajlepsze szczoteczki i pasty nie zadziaÅ‚ajÄ…, jeÅ›li myjesz zÄ™by za krÃ³tko lub pomijasz przestrzenie miÄ™dzyzÄ™bowe. Skuteczna higiena to powtarzalnoÅ›Ä‡ i konsekwencja.\n\n10. Korzystaj z indywidualnego instruktaÅ¼u i planu higieny\nBudujesz Å›wiadomoÅ›Ä‡, zwiÄ™kszasz zaangaÅ¼owanie w profilaktykÄ™ i zapobiegasz chorobom dziÄ…seÅ‚ i przyzÄ™bia.\n\n11. Wykonuj regularne przeglÄ…dy i higienizacjÄ™ co 6 miesiÄ™cy\nWiele problemÃ³w rozwija siÄ™ bez bÃ³lu i objawÃ³w. Regularna higienizacja pozwala wczeÅ›nie wykryÄ‡ problemy i zapobiega kosztownemu leczeniu.\n\n12. Wykonuj raz do roku badania kontrolne\nZdrowie jamy ustnej i caÅ‚ego organizmu sÄ… ze sobÄ… Å›ciÅ›le powiÄ…zane. Morfologia, Å¼elazo, witamina D, glukoza â€” regularne badania pomagajÄ… lepiej kontrolowaÄ‡ stany zapalne.\n\n13. Dbaj o dietÄ™ i korzystaj z opieki dietetyka klinicznego\nOgranicz cukry proste i czÄ™ste podjadanie, unikaj wysoko przetworzonych produktÃ³w. Wsparcie dietetyka pomaga zmniejszyÄ‡ stan zapalny i wspieraÄ‡ efekty leczenia stomatologicznego.`,
    Z3: `MASZ PYTANIA?\n\nJeÅ›li zauwaÅ¼ysz niepokojÄ…ce objawy (krwawienie, bÃ³l, nadwraÅ¼liwoÅ›Ä‡) â€” skontaktuj siÄ™ z gabinetem. Nie czekaj do nastÄ™pnej wizyty.\n\nZapraszam na mÃ³j Instagram po wiÄ™cej wskazÃ³wek dotyczÄ…cych zdrowia jamy ustnej.\n[Tu higienistka wpisuje swÃ³j Instagram lub inne dane kontaktowe]`,
    Z4: `Cel: usuniÄ™cie nocnego biofilmu bakteryjnego i ochrona zÄ™bÃ³w na caÅ‚y dzieÅ„. PamiÄ™taj: zÄ™by myjemy po przebudzeniu, ze Å›niadaniem czekamy 30 min.`,
    Z5: `Cel: dokÅ‚adna kontrola biofilmu bakteryjnego, wsparcie wygaszania stanu zapalnego i ochrona zÄ™bÃ³w oraz dziÄ…seÅ‚ w nocy.`
};

// ============ QUESTIONS ============
const questions = [
    { id: 'P1', title: 'Pytanie 1 z 7', question: 'Jaki jest gÅ‚Ã³wny problem pacjenta?', options: [
        { letter: 'a', text: 'Zdrowe dziÄ…sÅ‚a', value: 'R1' },
        { letter: 'b', text: 'Zapalenie dziÄ…seÅ‚', value: 'R2' },
        { letter: 'c', text: 'NadwraÅ¼liwoÅ›Ä‡ / starcia zÄ™bÃ³w', value: 'R3' },
        { letter: 'd', text: 'PrÃ³chnica aktywna', value: 'R4' },
        { letter: 'e', text: 'KamieÅ„ nazÄ™bny', value: 'R5' },
        { letter: 'f', text: 'Halitoza', value: 'R6' }
    ]},
    { id: 'P2', title: 'Pytanie 2 z 7', question: 'Jakie narzÄ™dzie gÅ‚Ã³wne?', options: [
        { letter: 'a', text: 'Szczoteczka soniczna', value: 'F1' },
        { letter: 'b', text: 'Szczoteczka rotacyjna', value: 'F2' },
        { letter: 'c', text: 'Szczoteczka manualna', value: 'F3' }
    ]},
    { id: 'P3', title: 'Pytanie 3 z 7', question: 'Czyszczenie przestrzeni miÄ™dzyzÄ™bowych?', options: [
        { letter: 'a', text: 'Szczoteczki miÄ™dzyzÄ™bowe', value: 'G1' },
        { letter: 'b', text: 'NiÄ‡ dentystyczna', value: 'G2' },
        { letter: 'c', text: 'Irygator', value: 'G3' },
        { letter: 'd', text: 'Szczoteczki + irygator', value: 'G4' }
    ]},
    { id: 'P4', title: 'Pytanie 4 z 7', question: 'Jaka pasta?', options: [
        { letter: 'a', text: 'Fluor', value: 'H1' },
        { letter: 'b', text: 'Hydroksyapatyt rano + fluor wieczÃ³r', value: 'H2' },
        { letter: 'c', text: 'Hydroksyapatyt', value: 'H3' }
    ]},
    { id: 'P5', title: 'Pytanie 5 z 7', question: 'PÅ‚yn do pÅ‚ukania?', options: [
        { letter: 'a', text: 'Tak', value: 'I1' },
        { letter: 'b', text: 'Nie', value: null }
    ]},
    { id: 'P6', title: 'Pytanie 6 z 7', question: 'Skrobak do jÄ™zyka?', options: [
        { letter: 'a', text: 'Tak', value: 'J1' },
        { letter: 'b', text: 'Nie', value: null }
    ]},
    { id: 'P7', title: 'Pytanie 7 z 7', question: 'NastÄ™pna wizyta?', options: [
        { letter: 'a', text: 'Za 3 miesiÄ…ce', value: 'X1' },
        { letter: 'b', text: 'Za 6 miesiÄ™cy', value: 'X2' },
        { letter: 'c', text: 'Za 12 miesiÄ™cy', value: 'X3' }
    ]}
];

let currentQ = 0;
let answers = {};

function renderQuestion() {
    const q = questions[currentQ];
    const pct = ((currentQ + 1) / 7 * 100).toFixed(1);
    document.getElementById('progress-text').textContent = q.title;
    document.getElementById('progress-fill').style.width = pct + '%';
    
    let html = `<div class="question-card"><h3>${q.title}</h3><p>${q.question}</p>`;
    q.options.forEach(o => {
        html += `<button class="option" onclick="selectOption('${q.id}','${o.value}',this)">${o.letter}) ${o.text}</button>`;
    });
    html += `</div>`;
    document.getElementById('question-container').innerHTML = html;
}

function selectOption(qId, value, btn) {
    answers[qId] = value === 'null' ? null : value;
    document.querySelectorAll('.option').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    
    setTimeout(() => {
        if (currentQ < 6) {
            currentQ++;
            renderQuestion();
        } else {
            generatePlan();
        }
    }, 300);
}

function nl2br(text) {
    return text.replace(/\n/g, '<br>');
}

function generatePlan() {
    document.getElementById('questions-section').classList.add('hidden');
    document.getElementById('plan-section').classList.remove('hidden');
    
    const a = answers;
    let html = '';
    
    // Z1 - WstÄ™p
    html += `<h2>ğŸ“‹ Indywidualny Plan Higieny Jamy Ustnej</h2>`;
    html += `<p>${nl2br(blocks.Z1)}</p>`;
    
    // Rozpoznanie
    html += `<h2>ğŸ” Rozpoznanie i Cel</h2>`;
    html += `<p>${nl2br(blocks[a.P1])}</p>`;
    
    // Lista zakupÃ³w
    html += `<h2>ğŸ›ï¸ Lista ZakupÃ³w â€” Co Potrzebujesz</h2>`;
    const shopItems = [];
    const brushKey = a.P2; // F1, F2, F3
    shopItems.push(blocks[brushKey]);
    const interKey = a.P3; // G1, G2, G3, G4
    shopItems.push(blocks[interKey]);
    const pasteKey = a.P4; // H1, H2, H3
    shopItems.push(blocks[pasteKey]);
    if (a.P5) shopItems.push(blocks[a.P5]);
    if (a.P6) shopItems.push(blocks[a.P6]);
    shopItems.forEach(item => {
        html += `<div class="shopping-item">${nl2br(item)}</div>`;
    });
    
    // Plan poranny
    html += `<h2>â˜€ï¸ Higiena Poranna</h2>`;
    html += `<p>${nl2br(blocks.Z4)}</p>`;
    let morningStep = 1;
    html += `<div class="step"><span class="step-num">Krok ${morningStep} â€” Szczotkowanie</span>${nl2br(blocks[brushKey + 'p'])}</div>`;
    morningStep++;
    if (a.P4 === 'H2' || a.P4 === 'H3') {
        html += `<div class="step"><span class="step-num">Krok ${morningStep} â€” Pasta poranna</span>${nl2br(blocks.H2a)}</div>`;
    }
    
    // Plan wieczorny
    html += `<h2>ğŸŒ™ Higiena Wieczorna</h2>`;
    html += `<p>${nl2br(blocks.Z5)}</p>`;
    let step = 1;
    
    // Przestrzenie miÄ™dzyzÄ™bowe
    if (a.P3 === 'G1') {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” Czyszczenie przestrzeni miÄ™dzyzÄ™bowych</span>${nl2br(blocks.G1p)}</div>`;
        step++;
    } else if (a.P3 === 'G2') {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” Czyszczenie przestrzeni miÄ™dzyzÄ™bowych</span>${nl2br(blocks.G2p)}</div>`;
        step++;
    } else if (a.P3 === 'G4') {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” Czyszczenie przestrzeni miÄ™dzyzÄ™bowych</span>${nl2br(blocks.G4a)}</div>`;
        step++;
    }
    // G3 (irygator only) - no interdental brushes step, irrigator comes later
    
    // Szczotkowanie
    html += `<div class="step"><span class="step-num">Krok ${step} â€” Szczotkowanie zÄ™bÃ³w</span>${nl2br(blocks[brushKey + 'p'])}</div>`;
    step++;
    
    // Skrobak
    if (a.P6) {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” Higiena jÄ™zyka</span>${nl2br(blocks.J1p)}</div>`;
        step++;
    }
    
    // Irygator (G3 or G4)
    if (a.P3 === 'G3' || a.P3 === 'G4') {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” Irygacja jamy ustnej</span>${nl2br(blocks.G3p)}</div>`;
        step++;
    }
    
    // PÅ‚yn
    if (a.P5) {
        html += `<div class="step"><span class="step-num">Krok ${step} â€” PÅ‚ukanie pÅ‚ynem</span>${nl2br(blocks.I1p)}</div>`;
        step++;
    }
    
    // Pasta wieczorna
    let eveningPasteBlock;
    if (a.P4 === 'H1') eveningPasteBlock = 'H1p';
    else if (a.P4 === 'H2') eveningPasteBlock = 'H2b';
    else eveningPasteBlock = 'H3p';
    html += `<div class="step"><span class="step-num">Krok ${step} â€” Pasta wieczorna</span>${nl2br(blocks[eveningPasteBlock])}</div>`;
    
    // 13 Zasad
    html += `<h2>ğŸ“– 13 Zasad Higieny Jamy Ustnej</h2>`;
    const zasady = blocks.Z2.split(/\n\n(?=\d+\.)/);
    zasady.forEach(z => {
        html += `<div class="zasada">${nl2br(z)}</div>`;
    });
    
    // Wizyta
    html += `<h2>ğŸ“… NastÄ™pna Wizyta</h2>`;
    html += `<p>${nl2br(blocks[a.P7])}</p>`;
    
    // Kontakt
    html += `<h2>ğŸ“ Kontakt</h2>`;
    html += `<p>Kontakt do kliniki: [DO UZUPEÅNIENIA]</p>`;
    html += `<p>${nl2br(blocks.Z3)}</p>`;
    
    document.getElementById('plan-output').innerHTML = html;
}

function resetPlanner() {
    currentQ = 0;
    answers = {};
    document.getElementById('questions-section').classList.remove('hidden');
    document.getElementById('plan-section').classList.add('hidden');
    renderQuestion();
}

// ============ TABS ============
function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-planner').classList.add('hidden');
    document.getElementById('tab-chat').classList.add('hidden');
    
    if (tab === 'planner') {
        document.getElementById('tab-planner').classList.remove('hidden');
        document.querySelectorAll('.tab')[0].classList.add('active');
    } else {
        document.getElementById('tab-chat').classList.remove('hidden');
        document.querySelectorAll('.tab')[1].classList.add('active');
        if (!chatInited) initChat();
    }
}

// ============ LIVE CHAT ============
let chatHistory = [];
let chatInited = false;

const SYSTEM_PROMPT = `JesteÅ› asystentem polskiej higienistki stomatologicznej.
Twoje zadanie: zadaÄ‡ 7 pytaÅ„, a nastÄ™pnie zÅ‚oÅ¼yÄ‡ gotowy plan higieny z blokÃ³w biblioteki.
Pracujesz WYÅÄ„CZNIE na poniÅ¼szej bibliotece blokÃ³w. Nie wymyÅ›lasz Å¼adnych treÅ›ci â€” kopiujesz dosÅ‚ownie teksty.

RODO: JeÅ›li higienistka wpisze imiÄ™, nazwisko, konkretny wiek, datÄ™, numer zÄ™ba lub opis kliniczny â€” PRZERWIJ i napisz:
"ProszÄ™ podaÄ‡ tylko literÄ™ odpowiedzi (a, b, câ€¦) â€” bez danych osobowych pacjenta."

Gdy higienistka wpisze cokolwiek â€” odpowiedz: "Zaczynamy. Odpowiadaj tylko literami â€” bez imion, dat i opisÃ³w klinicznych." i zadaj Pytanie 1.

SEKWENCJA PYTAÅƒ:
P1 â€” Problem gÅ‚Ã³wny: a) Zdrowe dziÄ…sÅ‚a b) Zapalenie dziÄ…seÅ‚ c) NadwraÅ¼liwoÅ›Ä‡/starcia d) PrÃ³chnica aktywna e) KamieÅ„ nazÄ™bny f) Halitoza
P2 â€” NarzÄ™dzie: a) Soniczna b) Rotacyjna c) Manualna
P3 â€” MiÄ™dzyzÄ™bowe: a) Szczoteczki b) NiÄ‡ c) Irygator d) Szczoteczki+irygator
P4 â€” Pasta: a) Fluor b) Hydroksy rano+fluor wieczÃ³r c) Hydroksyapatyt
P5 â€” PÅ‚yn: a) Tak b) Nie
P6 â€” Skrobak: a) Tak b) Nie
P7 â€” Wizyta: a) 3 mies b) 6 mies c) 12 mies

Po 7 odpowiedziach zÅ‚Ã³Å¼ plan. Nie wyÅ›wietlaj kodÃ³w blokÃ³w. Plan dla pacjenta.`;

function initChat() {
    chatInited = true;
    chatHistory = [{ role: 'system', content: SYSTEM_PROMPT }];
    addChatMsg('bot', 'CzeÅ›Ä‡! Jestem asystentem higienistki stomatologicznej. Wpisz "Start" aby rozpoczÄ…Ä‡ tworzenie planu higieny dla pacjenta. ğŸ¦·');
}

function addChatMsg(who, text) {
    const div = document.getElementById('chat-messages');
    div.innerHTML += `<div class="chat-msg ${who}"><div class="bubble">${text.replace(/\n/g,'<br>')}</div></div>`;
    div.scrollTop = div.scrollHeight;
}

async function sendChat() {
    const input = document.getElementById('chat-input');
    const msg = input.value.trim();
    if (!msg) return;
    input.value = '';
    
    addChatMsg('user', msg);
    chatHistory.push({ role: 'user', content: msg });
    
    const apiUrl = document.getElementById('api-url').value;
    
    try {
        addChatMsg('bot', 'â³ MyÅ›lÄ™...');
        const resp = await fetch(apiUrl, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer sk-spark-litellm-2026'
            },
            body: JSON.stringify({
                model: 'gpt-oss',
                messages: chatHistory,
                temperature: 0.3,
                max_tokens: 4000
            })
        });
        
        // Remove "thinking" message
        const msgs = document.getElementById('chat-messages');
        msgs.removeChild(msgs.lastChild);
        
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        const reply = data.choices[0].message.content;
        
        chatHistory.push({ role: 'assistant', content: reply });
        addChatMsg('bot', reply);
    } catch (e) {
        const msgs = document.getElementById('chat-messages');
        msgs.removeChild(msgs.lastChild);
        addChatMsg('bot', `âŒ BÅ‚Ä…d poÅ‚Ä…czenia: ${e.message}\n\nSprawdÅº czy:\nâ€¢ JesteÅ› w sieci lokalnej\nâ€¢ LiteLLM dziaÅ‚a na Sparku (192.168.1.80:4000)\nâ€¢ Adres API jest poprawny`);
    }
}

async function testApi() {
    const apiUrl = document.getElementById('api-url').value.replace('/chat/completions', '/models');
    try {
        const resp = await fetch(apiUrl, { headers: { 'Authorization': 'Bearer sk-spark-litellm-2026' }});
        if (resp.ok) alert('âœ… PoÅ‚Ä…czenie OK!');
        else alert(`âŒ BÅ‚Ä…d: HTTP ${resp.status}`);
    } catch(e) {
        alert(`âŒ Nie mogÄ™ siÄ™ poÅ‚Ä…czyÄ‡: ${e.message}`);
    }
}

// Copy plan as plain text
function copyPlanText() {
    const el = document.getElementById('plan-output');
    // Get text content, clean up
    const text = el.innerText;
    navigator.clipboard.writeText(text).then(() => {
        const toast = document.getElementById('copy-toast');
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 2000);
    }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = el.innerText;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        const toast = document.getElementById('copy-toast');
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 2000);
    });
}

// Init
renderQuestion();
</script>
</body>
</html>
